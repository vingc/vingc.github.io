<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Time Gap</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Time Gap">
<meta property="og:url" content="http://vingc.github.io/index.html">
<meta property="og:site_name" content="Time Gap">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Time Gap">
  
    <link rel="alternate" href="/atom.xml" title="Time Gap" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Time Gap</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">6/9</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://vingc.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-thinking-from-AWS-and-GITLAB-Operation-diruption" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/07/thinking-from-AWS-and-GITLAB-Operation-diruption/" class="article-date">
  <time datetime="2017-03-06T16:42:41.000Z" itemprop="datePublished">2017-03-06</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/technology/">technology</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/07/thinking-from-AWS-and-GITLAB-Operation-diruption/">thinking from AWS and GITLAB operation incident</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <hr>
<h4 id="Look-Back"><a href="#Look-Back" class="headerlink" title="Look Back"></a>Look Back</h4><p>GITLAB</p>
<p>On 2017/01/31, </p>
<ul>
<li>one engineer deleted the production database by running the command in production context, though his purpose was to remove the database in backup context.</li>
<li>take long time to recover the data from backup for useless backup mechanism.</li>
</ul>
<p><a href="https://about.gitlab.com/2017/02/01/gitlab-dot-com-database-incident/" target="_blank" rel="external">detail: blog of GITLAB</a></p>
<p>AWS</p>
<p>On 2017/02/28, </p>
<ul>
<li>one engineer deleted a larger set of S3 server3 than expected by typing a wrong parameter of the inputs to the command. </li>
<li>take unexpected long time to restore the whole S3 service for massive data.</li>
</ul>
<p><a href="https://aws.amazon.com/cn/message/41926/" target="_blank" rel="external">detail: announcement of AWS</a></p>
<h4 id="Thinking"><a href="#Thinking" class="headerlink" title="Thinking"></a>Thinking</h4><p>There are common factors in these two incidents derived from different causes.</p>
<h5 id="The-first-operator-factor"><a href="#The-first-operator-factor" class="headerlink" title="The first, operator factor."></a>The first, operator factor.</h5><p>They all typed critical operational commands in terminal, which means that the results of operations depend on people’s vigor,mind,mood,emotion, and office environment,flavor of coffee,Trump’s newest tweet,date of yester night…</p>
<p>Too many elements can affect Human, which let us make mistakes, as Murphy’s Law (Anything that can go wrong will go wrong).</p>
<p>More inputs by operator, more possibility of error.</p>
<p>We can reduce the possibility of error by reduce the operator factor in workflow.</p>
<p>How?</p>
<ul>
<li>DevOps</li>
<li>Automation system</li>
<li>Workflow standardization</li>
<li>Design principles</li>
<li>container</li>
<li>Others</li>
</ul>
<p>List some examples. </p>
<p>A button of Automation system to remove server or database is better than a command need be input. A button only needs to be clicked once by mouse, but a command usually needs to be input by typing tens of different keys on keyboard. Furthermore, we can make double-check by popping up a dialog when button is clicked, meanwhile popup can slow the actions of emergency operations, give operator more time and another chance to think and confirm, decrease the possibility of error. Speed is not our first objective, accuracy is. </p>
<p>Looked at another way, Automation system can limit unexpected operations. For example, When operator is removing the database, the system checks the service firstly, when it finds out that there is business data being transited between the database and the business service system, the automation system can reject this operation which can disrupt the online service.</p>
<p><em>People always make mistakes, but machine not. Trust system, not operator.</em></p>
<h5 id="The-second-backup-factor"><a href="#The-second-backup-factor" class="headerlink" title="The second, backup factor."></a>The second, backup factor.</h5><p>In front two events, backup and recovery mechanism didn’t work as expected. In Software Engineering, if a software doesn’t work as expected, there must be something wrong to be fixed or tuned.</p>
<p>I don’t talk about my thought of the backup mechanism, just list others’:</p>
<ul>
<li><a href="https://gitlab.com/gitlab-com/infrastructure/issues/1102" target="_blank" rel="external">GITLAB issue</a></li>
<li><a href="https://gitlab.com/gitlab-com/www-gitlab-com/issues/1108" target="_blank" rel="external">Comment of HaoChen</a></li>
</ul>
<p>Summary:</p>
<ul>
<li>Automated testing of recovering [PostgreSQL database] backups</li>
<li>HA design, high available distribution system</li>
</ul>
<h4 id="Last-words"><a href="#Last-words" class="headerlink" title="Last words"></a>Last words</h4><p>I was surprised and moved by the way GITLAB dealing with the incident, loyal to the truth and transparency. As a Chinese who has been deceived and duped for many years by Chinese government and Chinese media and Chinese companies, the transparency is a beam of clear light to my dark life.</p>
<p>黑夜給了我黑色的眼睛／我卻用它尋找光明</p>
<p>–Darkness gives me a pair of black eyes , while I use them to look for brightness.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://vingc.github.io/2017/03/07/thinking-from-AWS-and-GITLAB-Operation-diruption/" data-id="cizy99to00005dwjfaw02v8un" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/operation/">operation</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-optimization-of-ssh-agent-and-ssh-keys-for-git-bash" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/06/optimization-of-ssh-agent-and-ssh-keys-for-git-bash/" class="article-date">
  <time datetime="2017-03-05T23:18:41.000Z" itemprop="datePublished">2017-03-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/technology/">technology</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/06/optimization-of-ssh-agent-and-ssh-keys-for-git-bash/">optimization of ssh-agent and ssh-add for git bash</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <hr>
<h4 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h4><p>Several days ago, To use github, i installed git in my new laptop for the first time, and encountered a problem about management of ssh-agent and ssh keys.</p>
<p>After starting a new “git bash” terminal, there was something wrong when pushed my new commit, see below picture:</p>
<p><img src="../images/ssh_error.png" alt="error"></p>
<p>when used command “ssh-add -l” to check the private keys added, it returned an error, the key error message “Could not open a connection to your authentication agent” .</p>
<h4 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h4><p>After google, realized that “git bash” needs us to start the “ssh-agent” process before “ssh-add” and “git” command using ssh protocol. </p>
<p><a href="http://stackoverflow.com/questions/17846529/could-not-open-a-connection-to-your-authentication-agent/10077302#10077302" target="_blank" rel="external">resolution in StackOverFlow</a></p>
<p>Sure, we can fix it manually, but why “git bash” doesn’t start “ssh-agent” itself when the terminal launched？as we all know we always need it.</p>
<p>Now, lay the question aside firstly, i wanted to let git work elegantly.</p>
<p>Do we execute commands “eval `ssh-agent -s`“ and “ssh-add ~/.ssh/github_rsa” every time when launch a “git bash” terminal?</p>
<p> No, of course not, i can’t bear this trouble, as a engineer who develops software to make life easier.</p>
<p>we can follow the “good” <a href="http://anterence.blogspot.com/2012/01/ssh-agent-in-msysgit.html" target="_blank" rel="external">tutorial</a> to let “git bash” start “ssh-agent” itself by appending the commands to the configuration file “$git_installed_directory/etc/bash.bashrc”.</p>
<p>Have we done?</p>
<p>Ha, haven’t, it’s a good resolution, but not the best.</p>
<p>I tested the resolution by opening several “git bash” terminals at the same time, see the picture:</p>
<p><img src="../images/dup_ssh_processes.png" alt="multiple processes"></p>
<p>There would be multiple processes if we opened several “git bash” terminals, each process per time.</p>
<p>This was not elegant. I couldn’t bear this resolution too. I wanted to optimize it.</p>
<h4 id="Final"><a href="#Final" class="headerlink" title="Final"></a>Final</h4><p>New resolution:  check whether the ssh-agent has been started, it’s dependent on the result to execute commands or not.</p>
<p>here is the code:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">#start ssh-agent and add keys</div><div class="line">SERVICE=&apos;ssh-agent&apos;</div><div class="line"></div><div class="line">if ps -ef|grep -u $SERVICE &gt;/dev/null   #check whether the process started by current user exists </div><div class="line">then</div><div class="line">   echo $SERVICE running.</div><div class="line">else</div><div class="line">   echo $SERVICE not running.</div><div class="line">   ssh-agent &gt; ~/.ssh/agent_env  #start the process,and dump the environment variables</div><div class="line">   ssh-add ~/.ssh/github_rsa     #just for once,replace &apos;github_rsa&apos; with your private key</div><div class="line">fi</div><div class="line">. ~/.ssh/agent_env   #export the environment variables</div></pre></td></tr></table></figure>
<p>Add these lines into the end of the configuration file “$git_installed_directory/etc/bash.bashrc”.</p>
<p>Things have been finished, although still had questions here.</p>
<ul>
<li>why do we need to add key each time when “ssh-agent” started? </li>
<li>where is it stored? Don’t need to add it every time if keep it stored durably. </li>
</ul>
<p>Less procedure, launch faster. I will figure out.</p>
<h4 id="——2017-03-06——"><a href="#——2017-03-06——" class="headerlink" title="——2017-03-06——"></a>——2017-03-06——</h4><p>continue…</p>
<p>I think the private key identities is stored in memory of ssh-agent process space, so when stop the process, the data would be lost, and don’t need further tuning after trading off.</p>
<h4 id="appendix"><a href="#appendix" class="headerlink" title="appendix"></a>appendix</h4><ul>
<li><a href="https://www.freebsd.org/cgi/man.cgi?query=ssh-add&amp;sektion=1" target="_blank" rel="external">More information about ssh-add</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://vingc.github.io/2017/03/06/optimization-of-ssh-agent-and-ssh-keys-for-git-bash/" data-id="cizy99tnl0000dwjfgmfadha4" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/git-bash-ssh-agent-ssh-add/">git-bash ssh-agent ssh-add</a></li></ul>

    </footer>
  </div>
  
</article>


  

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/technology/">technology</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/git-bash-ssh-agent-ssh-add/">git-bash ssh-agent ssh-add</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/operation/">operation</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/git-bash-ssh-agent-ssh-add/" style="font-size: 10px;">git-bash ssh-agent ssh-add</a> <a href="/tags/operation/" style="font-size: 10px;">operation</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/03/07/thinking-from-AWS-and-GITLAB-Operation-diruption/">thinking from AWS and GITLAB operation incident</a>
          </li>
        
          <li>
            <a href="/2017/03/06/optimization-of-ssh-agent-and-ssh-keys-for-git-bash/">optimization of ssh-agent and ssh-add for git bash</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 Vingc Zhang<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>